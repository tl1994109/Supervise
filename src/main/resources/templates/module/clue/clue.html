<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>

<style type="text/css">
    .colStyle {
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
    }
</style>

<body class="gray-bg">
    <div class="container-div">
        <div class="col-sm-12 select-info search-collapse">
            <form id="case" class="form-horizontal">
              <div class="form-group select-info-container">
                  <!--<label>线索ID：</label>-->
                      <input type="hidden"  name="clueId" id="clueId">
                      <!--<label>线索来源(1系统策略筛查 2信访录入)：</label>-->
                      <input type="hidden"  name="clueSource">

                  <div class="col-sm-4">
                      <label>可疑点：</label>
                      <input type="text"  name="dubvioStrategyName">
                  </div>
                  <div class="col-sm-4">
                      <label>反映人：</label>
                      <input type="text"  name="clueFyr">
                  </div>
                  <div class="col-sm-4">
                      <label>被反映人：</label>
                      <input type="text"  name="clueFydx">
                  </div>
               </div>
              <div class="form-group select-info-container">
                  <!--<div class="col-sm-4">-->
                      <!--&lt;!&ndash;<label>反映电话：</label>&ndash;&gt;-->
                      <input type="hidden"  name="clueFyrdh">
                  <!--</div>-->
                  <div class="col-sm-4">
                      <label>案号：</label>
                      <input type="text"  name="jbxxAh">
                  </div>

                  <div class="col-sm-4">
                      <label>反映问题：</label>
                      <input type="text"  name="clueFywt">
                  </div>
                  <!--<div class="col-sm-4">-->
                      <!--<label>法官姓名：</label>-->
                      <!--<input type="text"  name="jbxxCbrName">-->
                  <!--</div>-->
                  <div class="col-sm-4">
                      <label>承办庭名称：</label>
                      <input type="text"  name="jbxxCbtName">
                  </div>
               </div>

              <div class="form-group select-info-container">
                  <!--<div class="col-sm-4">-->
                      <!--<label>法官ID：</label>-->
                  <!--<label>案件编号：</label>-->
                  <input type="hidden"  name="jbxxAjbh">
                      <input type="hidden"  name="jbxxCbrId">
                  <!--<label>线索状态：</label>-->
                  <input type="hidden"  name="clueStatus">
                  <!--<label>违纪事件ID：</label>-->
                  <input type="hidden"  name="dubvioId">
                  <!--<label>策略ID：</label>-->
                  <input type="hidden"  name="dubvioStrategyId">
                  <!--</div>-->

                  <!--<div class="col-sm-4">-->
                      <!--<label>被告人：</label>-->
                      <!--<input type="text"  name="jbxxBgr">-->
                  <!--</div>-->

                  <div class="col-sm-4">
                      <label>案件类别：</label>
                      <select id="jbxxAjlb" name="jbxxAjlb" >
                          <option value ="">请选择</option>
                          <option value ="刑事">刑事</option>
                          <option value ="民事">民事</option>
                          <option value="执行">执行</option>
                          <option value="行政">行政</option>
                      </select>
                  </div>

                  <div class="col-sm-4">
                      <label>风险等级：</label>
                      <select id="risksLevel" name="risksLevel" th:with="type=${@dict.getType('risks_grades')}">
                          <option value="">请选择</option>
                          <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                      </select>
                  </div>

                  <div class="col-sm-4">
                      <label>经办法院：</label>
                      <select name="jbfyId" id="jbfyId">
                          <option value="">请选择</option>
                          <option th:each="deptList:${deptList}" th:value="${deptList.cid}"
                                  th:text="${deptList.deptName}"></option>
                      </select>
                  </div>
                  <!--<div class="col-sm-4">-->
                  <!--<label>收案日期：</label>-->
                  <input type="hidden"  name="jbxxSarq">
                  <!--</div>-->
                  <!--<div class="col-sm-4">-->
                  <!--<label>承办庭ID：</label>-->
                  <input type="hidden"  name="jbxxCbtId">
                  <!--</div>-->
                  <!--<div class="col-sm-4">-->
                  <!--<label>立案日期：</label>-->
                  <input type="hidden"  name="jbxxLarq">
                  <!--</div>-->
                  <!--<div class="col-sm-4">-->
                  <!--<label>分案日期：</label>-->
                  <input type="hidden"  name="jbxxFarq">
                  <!--</div>-->
                  <!--<div class="col-sm-4">-->
                  <!--<label>开庭日期：</label>-->
                  <input type="hidden"  name="jbxxKtrq">
                  <!--</div>-->
                  <!--<label>结案日期：</label>-->
                  <input type="hidden"  name="jbxxJarq">
                  <!--<label>归档日期：</label>-->
                  <input type="hidden"  name="jbxxGdrq">
               </div>



                <div class="form-group select-info-container">
                    <div class="col-sm-12 select-info-btn">
                        <a class="btn btn-primary btn-rounded btn-sm" onclick="initSimpleTabl.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                        <a class="btn btn-warning btn-rounded btn-sm" onclick="formComponent.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                    </div>
                </div>
            </form>
        </div>
		<div class="btn-group-sm hidden-xs" id="toolbar" role="group">
			<!--<a class="btn btn-success" onclick="operateComponent.add('module/clue/add','信访录入 ')" shiro:hasPermission="module:clue:add">-->
				<!--<i class="fa fa-plus"></i> 信访录入-->
			<!--</a>-->
            <!--<a class="btn btn-danger" onclick="detail()" shiro:hasPermission="module:clue:detail">-->
                <!--<i class="fa fa-plus"></i> 可疑点详细-->
            <!--</a>-->
            <!--<a class="btn btn-warning btn-edit disabled" onclick="operateComponent.edit('','module/clue/edit/{id}','线索 ')" shiro:hasPermission="module:clue:edit">-->
                <!--<i class="fa fa-plus"></i> 编辑-->
            <!--</a>-->
			<a class="btn btn-danger btn-del disabled" onclick="operateComponent.removeAll('module/clue/remove')" shiro:hasPermission="module:clue:remove">
				<i class="fa fa-trash-o"></i> 批量删除
			</a>
            <a class="btn btn-select">
				<span id="exportToolbar" class="btn-group" style="width: 110px; display: inline-block">
					<select id="sel_exportoption" class="">
						<option value="">导出当页数据</option>
						<option value="all">导出全部数据</option>
						<option value="selected">导出选中数据</option>
					</select>
				</span>
            </a>
		</div>

		<div class="col-sm-12 select-table table-striped">
			<table id="bootstrap-table" data-mobile-responsive="true"></table>
		</div>
    </div>
    <div th:include="include :: footer"></div>
    <script th:inline="javascript">
        var editFlag = [[${@permission.hasPermi('module:clue:edit')}]];
        var removeFlag = [[${@permission.hasPermi('module:clue:remove')}]];
        var releaseFlag = [[${@permission.hasPermi('module:clue:release')}]];
        var listFlag = [[${@permission.hasPermi('module:clue:list')}]];
        var datas_18 = [[${@dict.getType('risks_grades')}]];
        var prefix = ctx + "module/clue";
        $(function() {
            var options = {
                url: prefix + "/list",
				search: false,
                columns: [{
		            checkbox: true
		        },
                    {
                        field : 'clueId',
                        title : '线索ID',
                        visible: false
                    },

                    {
                        field : 'dubvioStrategyName',
                        title : '反映问题',
                        class:'colStyle',
                        width:120,
                        formatter:paramsMatter
                    },
                    {
                        field : 'jbxxAh',
                        title : '案号',
                        formatter:function(value,row,index){
                            //return "<a style='text-decoration:none' onclick='clueDetail("+row.dubvioId+")' ><font color='blue'>" + row.jbxxAh +"</font></a>";
                            var id= '"' +  row.clueId + '"';
                            if(row.jbxxAh== null){
                                return "<font color='blue'>暂无案号</font>";
                            }else {
                                return "<a style='text-decoration:none' onclick='clueDetail("+id+")' ><font color='blue'>" + row.jbxxAh +"</font></a>";
                            }

                        }
                    },
                // {
                //     field : 'clueSource',
                //     title : '线索来源(1系统策略筛查 2信访录入)',
                //     visible: false
                //                     },
                {
                    field : 'clueFyr',
                    title : '反映人',
                                    },
                {
                    field : 'clueFyrdh',
                    title : '反映电话',
                    visible: false
                                    },
                {
                    field : 'clueFydx',
                    title : '被反映人',
                                    },
                {
                    field : 'dubvioId',
                    title : '违纪事件ID',
                    visible: false
                                    },
                {
                    field : 'dubvioStrategyId',
                    title : '策略ID',
                    visible: false
                                    },

                {
                    field : 'jbxxAjbh',
                    title : '案件编号',
                    visible: false
                                    },

                {
                    field : 'jbxxCbrId',
                    title : '法官ID',
                    visible: false
                                    },
                {
                    field : 'jbxxCbrName',
                    title : '法官姓名',
                    visible: false
                                    },
                {
                    field : 'jbxxBgr',
                    title : '被告人',
                    visible: false
                                    },
                {
                    field : 'jbxxCbtId',
                    title : '承办庭ID',
                    visible: false
                                    },
                {
                    field : 'jbxxCbtName',
                    title : '承办庭名称',
                                    },
                {
                    field : 'jbxxAjlb',
                    title : '案件类别',
                                    },
                {
                    field : 'jbxxSarq',
                    title : '收案日期',
                    visible: false
                                    },
                {
                    field : 'jbxxLarq',
                    title : '立案日期',
                    visible: false
                                    },
                {
                    field : 'jbxxFarq',
                    title : '分案日期',
                    visible: false
                                    },
                {
                    field : 'jbxxKtrq',
                    title : '开庭日期',
                    visible: false
                                    },
                {
                    field : 'jbxxJarq',
                    title : '结案日期',
                    visible: false
                                    },
                {
                    field : 'jbxxGdrq',
                    title : '归档日期',
                    visible: false
                                    },
                    {
                        field : 'jbfyName',
                        title : '经办法院',
                    },
                {
                    field : 'risksLevel',
                    title : '风险等级',
                    formatter: function(value, row, index) {
                        return initSimpleTabl.selectDictLabel(datas_18, value);
                    }
                                    },
                {
                    field : 'createTime',
                    title : '创建时间',
                    formatter:function(value, row, index){
                        return /\d{4}-\d{1,2}-\d{1,2}/g.exec(value)
                    }
                                    },
                {
                    field : 'processId',
                    title : '流程ID',
                    visible: false
                                    },
                    {
                        field : 'clueRemarks',
                        title : '处置结果',
                        formatter:function (value, row, index) {
                            if (value !=''&&value !=null){
                                return "<span class='badge badge-default'>"+value+"</span>"
                            } else {
                                return "<span class='badge badge-default'>"+"正常"+"</span>"
                            }

                        }
                    },
		        {
		            title: '操作',
		            align: 'center',
		            formatter: function(value, row, index) {
		            	var actions = [];
                        //actions.push('<a class="btn btn-warning btn-xs ' + releaseFlag + '" href="#" onclick="release(\'' + row.clueId  + '\');"><i class="fa fa-plus"></i>问题处置</a> ');

                        if(row.deleteFlag =='0' && row.processStatus=="2"){
                            actions.push('<a class="btn btn-warning btn-xs ' + releaseFlag + '" href="#" onclick="release(\'' + row.clueId  + '\');"><i class="fa fa-plus"></i>问题处置</a> ');
                            // actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" onclick="operateComponent.remove(\'' + row.clueId + '\'\,\'module/clue/remove\'\,\'线索 \')"><i class="fa fa-remove"></i>删除</a>');
                        }else if((row.deleteFlag=='0' && row.processStatus=="0")||(row.clueStatus=="0"&&row.processStatus=="0")){
                            actions.push('<p  class="btn btn-primary btn-rounded btn-xs"  >已通过</p> ');
                            // actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" disabled="disabled"><i class="fa fa-remove"></i>删除</a>');
                        }else if(row.deleteFlag == '0' && row.processStatus=="1"){
                            actions.push('<p  class="btn btn-primary btn-rounded btn-xs" >进行中</p> ');
                            // actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" disabled="disabled"><i class="fa fa-remove"></i>删除</a>');
                        }else if(row.deleteFlag == '1'){
                            actions.push('<a class="btn btn-warning btn-xs ' + releaseFlag + '" href="#" disabled="disabled"><i class="fa fa-plus"></i>问题处置</a> ');
                            // actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" disabled="disabled"><i class="fa fa-remove"></i>删除</a>');
                        }
                        // actions.push('<a class="btn btn-info btn-xs ' + listFlag + '" href="#" onclick="detail(\'' + row.clueId + '\')"><i class="fa fa-list-ul"></i>可疑点详情</a> ');
		            	//actions.push('<a class="btn btn-success btn-xs ' + editFlag + '" href="#" onclick="operateComponent.edit(\'' + row.clueId + '\'\,\'module/clue/edit/{id}\'\,\'线索 \')"><i class="fa fa-edit"></i>编辑</a> ');
						return actions.join('');
		            }
		        }]
            };
            initSimpleTabl.init(options);
        });
    layui.use('laydate', function(){
        var laydate = layui.laydate;
        laydate.render({elem: '#startTime', theme: 'molv'});
        laydate.render({elem: '#endTime_12', theme: 'molv'});
        laydate.render({elem: '#startTime_13', theme: 'molv'});
        laydate.render({elem: '#endTime_13', theme: 'molv'});
        laydate.render({elem: '#startTime_14', theme: 'molv'});
        laydate.render({elem: '#endTime_14', theme: 'molv'});
        laydate.render({elem: '#startTime_15', theme: 'molv'});
        laydate.render({elem: '#endTime_15', theme: 'molv'});
        laydate.render({elem: '#startTime_16', theme: 'molv'});
        laydate.render({elem: '#endTime_16', theme: 'molv'});
        laydate.render({elem: '#startTime_17', theme: 'molv'});
        laydate.render({elem: '#endTime_17', theme: 'molv'});
    });


        function release(clueId){
            $.modal.openFull("问题处置", prefix+"/release?clueId=" + clueId);
        }

        function selectProcess(clueId){
            $.modal.open("查看流程履历", ctx + "module/processResume?matterId=" + clueId);
        }

        /*策略列表-详细*/
        function detail(clueId) {
            var url = prefix + '/detail/';
            createMenuItem(url, "策略详情");
        }


        function clueDetail(clueId){
            var url = prefix + '/edits?clueId='+clueId ;
            createMenuItem(url, "案件详情");
        }
        function paramsMatter(value, row, index) {

            var values = row.dubvioStrategyName;//获取当前字段的值
            //替换空格，因为字符串拼接的时候如果遇到空格，会自动将后面的部分截掉，所有这里用html的转义符
            // 代替
            if(values !=null && values!=""){
                values = values.replace(/\s+/g,'');
                return "<p style='text-overflow:ellipsis;overflow: hidden;white-space:nowrap;width: 120px;margin: 0px' title="+values+">"+row.dubvioStrategyName+"</p>";
            }
            return "";
        }

    </script>
    <!--bootstrap-table-export数据导出-->
    <script type="text/javascript">
        $("#sel_exportoption").change(function () {
            //刷新参数设置
            $('#bootstrap-table').bootstrapTable('refreshOptions', {
                exportDataType: $(this).val()
            });
        });
    </script>
</body>
</html>